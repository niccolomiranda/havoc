function imgPreloaded(){imgTotal--,0===imgTotal&&utils.loadJSON(gotMainLocations,"data/mainlocation.json")}function gotMainLocations(t){mainLocation=JSON.parse(t),utils.loadJSON(gotLocations,"data/countries.json")}function gotLocations(t){jsonData=JSON.parse(t),utils.currentDevice=utils.deviceType();new Scene(jsonData,mainLocation)}function translateData(){utils.loadJSON(gotData,"data/rawdubai.json")}function gotData(t){for(var e=JSON.parse(t),i=[],s=0;s<24;s++)i.push({});for(var n=[],s=0;s<e.length;s++){var o=e[s],a=o.hour.length<6?parseInt(o.hour.charAt(0)):parseInt(o.hour.charAt(0)+o.hour.charAt(1));i[a][o.ctry_nm]?i[a][o.ctry_nm]+=Math.round(o.amt_pv):i[a][o.ctry_nm]=Math.round(o.amt_pv);for(var r=!1,h=0;h<n.length;h++)if(o.ctry_nm===n[h]){r=!0;break}r||n.push(o.ctry_nm)}}function Globe(){this.radius=300,this.geometry=new THREE.BufferGeometry,this.onIntro=!0;for(var t=this.ptNB=3e4,e=new Float32Array(3*t),i=new Float32Array(2*t),s=new Float32Array(2*t),n=new Float32Array(t),o=0;o<t;o++){var a=3*o,r=2*o;s[r+1]=Math.acos(-1+2*o/t),s[r]=Math.sqrt(t*Math.PI)*s[r+1],e[a]=Math.cos(s[r])*Math.sin(s[r+1])*this.radius,e[a+1]=Math.cos(s[r+1])*this.radius,e[a+2]=Math.sin(s[r+1])*Math.sin(s[r])*this.radius;var h=Math.cos(s[r])*Math.sin(s[r+1]),l=Math.sin(s[r+1])*Math.sin(s[r]),c=Math.cos(s[r+1]);i[r]=.5-Math.atan2(l,h)/(2*Math.PI),i[r+1]=.5+Math.asin(c)/Math.PI,n[o]=o}this.geometry.addAttribute("position",new THREE.BufferAttribute(e,3)),this.geometry.addAttribute("uv",new THREE.BufferAttribute(i,2)),this.geometry.addAttribute("latlng",new THREE.BufferAttribute(s,2)),this.geometry.addAttribute("i",new THREE.BufferAttribute(n,1)),this.uniforms={time:{type:"f",value:1},length:{type:"f",value:t},zoom:{type:"f",value:1},radius:{type:"f",value:this.radius},percTime:{type:"f",value:1},camPos:{type:"v3",value:new THREE.Vector3},reveal:{type:"f",value:0},camDist:{type:"f",value:0},earth:{type:"t",value:THREE.ImageUtils.loadTexture(imgList.earth)},particle:{type:"t",value:THREE.ImageUtils.loadTexture(imgList.earthParticles)}},this.attributes={i:{type:"f",value:[]},latlng:{type:"v2",value:[]}},this.material=new THREE.ShaderMaterial({vertexShader:window.shaderList.globe.vertex,fragmentShader:window.shaderList.globe.fragment,blending:THREE.AdditiveBlending,uniforms:this.uniforms,attributes:this.attributes,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),this.pointCloud=new THREE.PointCloud(this.geometry,this.material)}function LightBeam(t,e,i,s,n,o){this.from=t,this.to=e,this.t=0,this.id=n,this.location=s,this.radius=i,this.isStart=o,this.isHidded=!1,this.isStopped=!1,this.threshold=LightBeam.THRESHOLD=.005,this.distance=Math.acos(Math.sin(t.x)*Math.sin(e.x)+Math.cos(t.x)*Math.cos(e.x)*Math.cos(t.y-e.y)),this.geometry=new THREE.BufferGeometry,this.currPos=new THREE.Vector3(0)}function LineParticles(t,e,i,s,n,o){this.geometry=new THREE.BufferGeometry;var a=n/Math.PI*180,r=this.ptNB=2e3+Math.round(a/180*1500);this.lineVert=t;for(var h=new Float32Array(3*r),l=new Float32Array(3*r),c=new Float32Array(r),u=new Float32Array(r),d=0;d<r;d++){var m=3*d,p=1+Math.floor((t.length-1)*Math.random()),v=Math.random();u[d]=v,h[m]=0,h[m+1]=0,h[m+2]=0,l[m]=.005*Math.random(),l[m+1]=Math.random();var g=Math.random()<.5?-1:1;l[m+2]=Math.random()>.9?g*(5+10*Math.random()):0,c[d]=p}this.geometry.addAttribute("position",new THREE.BufferAttribute(h,3)),this.geometry.addAttribute("movePar",new THREE.BufferAttribute(l,3)),this.geometry.addAttribute("ind",new THREE.BufferAttribute(c,1)),this.geometry.addAttribute("percBetween",new THREE.BufferAttribute(u,1)),this.uniforms={time:{type:"f",value:o},radius:{type:"f",value:s},distance:{type:"f",value:n},extraBounce:{type:"f",value:0},from:{type:"v2",value:e},vel:{type:"v2",value:new THREE.Vector2(0)},mousePos:{type:"v2",value:new THREE.Vector2(0)},window:{type:"v2",value:new THREE.Vector2(Scene.WIDTH,Scene.HEIGHT)},mouseRadius:{type:"f",value:.02},mouseHeight:{type:"f",value:0},to:{type:"v2",value:i},vLength:{type:"f",value:t.length},distRatio:{type:"f",value:a/180},color:{type:"v3",value:Scene.COLORDAY},reveal:{type:"f",value:0},camPos:{type:"v3",value:new THREE.Vector3},weight:{type:"f",value:1},camDist:{type:"f",value:0},direction:{type:"f",value:1},zoom:{type:"f",value:1}},this.attributes={movePar:{type:"v2",value:[]},percBetween:{type:"f",value:[]},ind:{type:"f",value:[]}},this.material=new THREE.ShaderMaterial({vertexShader:window.shaderList.particlesLine.vertex,fragmentShader:window.shaderList.particlesLine.fragment,blending:THREE.AdditiveBlending,uniforms:this.uniforms,attributes:this.attributes,depthWrite:!1,depthTest:!1,transparent:!0}),this.showTween=this.hideTween=null,this.pointCloud=new THREE.PointCloud(this.geometry,this.material)}function Location(t,e,i,s,n,o,a){this.isName=!1,this.id=i,this.label=e,this.radius=s,this.zoom=a,this.isVisible=!0,this.isStarted=!1;var r=128;this.canPoint=document.createElement("canvas"),this.canPoint.setAttribute("width",r),this.canPoint.setAttribute("height",r),this.pointCtx=this.canPoint.getContext("2d");var h=document.createElement("img"),l=new THREE.Texture(this.canPoint);l.needsUpdate=!0,this.uniforms={texture:{type:"t",value:l},color:{type:"v3",value:new THREE.Vector3(255,255,255)},camPos:{type:"v3",value:new THREE.Vector3},camDist:{type:"f",value:0},reveal:{type:"f",value:0},zoom:{type:"f",value:1},radius:{type:"f",value:s}},h.onload=function(){this.pointCtx.drawImage(h,0,0),this.uniforms.texture.value.needsUpdate=!0}.bind(this),h.src="./img/point.png",this.attributes={};var c=new THREE.ShaderMaterial({vertexShader:window.shaderList.label.vertex,fragmentShader:window.shaderList.label.fragment,blending:THREE.AdditiveBlending,uniforms:this.uniforms,attributes:this.attributes,transparent:!0,depthWrite:!1,depthTest:!1,side:THREE.BackSide});this.mark=new THREE.Mesh(o,c),this.middle=new THREE.Vector3(0);var u=utils.latlngtovec(t);this.mark.position.set(u.x*(s+1),u.y*(s+1),u.z*(s+1)),this.mark.lookAt(this.middle);3.5+.5*Math.random()}function MainLocation(t,e,i,s,n,o,a,r){this.label=e,this.id=i,this.time=0,this.timezone=n,this.file=s,this.radius=o;var h=new THREE.MeshBasicMaterial({color:16711680});this.mark=new THREE.Mesh(a,h),this.mark.visible=!1;var l=utils.degtorad(t.lat),c=utils.degtorad(-1*t.lng),u=new THREE.Vector2(l,c);this.latlng=u;var d=utils.latlngtovec(u);this.mark.position.set(d.x*(o+1),d.y*(o+1),d.z*(o+1)),this.mark.lookAt(new THREE.Vector3(0)),this.click=document.createElement("a"),this.click.setAttribute("href","#"),this.click.setAttribute("id","globe-btn"+i),this.click.setAttribute("data-id",i),this.innerClick=document.createElement("div"),this.click.appendChild(this.innerClick),this.text=document.createElement("div"),this.innerClick.appendChild(this.text),this.text.classList.add("text"),this.click.classList.add(this.file.split(".json").join("").split("data/").join("")),this.text.innerHTML=e,document.getElementById("globe-buttons").appendChild(this.click),this.threetodom=new ThreeToDom(r,this.mark,this.click,0,0),this.dummy=0,TweenLite.to(this,.5,{value:1,onComplete:this.showClick.bind(this),delay:3+.1*this.id})}function PlaneBeam(t,e,i,s){for(var n=10,o=t.length-1,a=n+1,r=o+1,h=new Float32Array(a*r*3),l=new Float32Array(a*r*2),c=new Float32Array(a*r),u=new Float32Array(a*r),d=new Float32Array(a*r),m=i/Math.PI*180,p=0,v=0,g=0,f=.05+.05*(m/180),y=utils.vectolatlng(t[0]),w=0,T=0;T<r;T++){var E=utils.vectolatlng(t[T]),L=Math.atan2(E.y-y.y,E.x-y.x)+.5*Math.PI;Math.abs(E.y-y.y)>=Math.PI&&(L=w);for(var b=.4+.2*Math.random(),M=0;M<a;++M){c[g]=T,d[g]=b;var x=1-Math.abs(M/a*2-1),P=-f+2*f/a*M,H=utils.latlngtovec(new THREE.Vector2(E.x+Math.cos(L)*P,E.y+Math.sin(L)*P)),S=e+Math.sin(1-Math.abs(2*(T/t.length-.5)))*Math.max(10,18*i)*x;h[p]=H.x*S,h[p+1]=H.y*S,h[p+2]=H.z*S,l[v]=M/a,l[v+1]=T/r,u[g]=x,p+=3,v+=2,g++}y=E,w=L}p=0;for(var B=new(h.length/3>65535?Uint32Array:Uint16Array)(n*o*6),I=0;I<o;I++)for(var R=0;R<n;R++){var k=R+a*I,A=R+a*(I+1),C=R+1+a*(I+1),D=R+1+a*I;B[p]=k,B[p+1]=A,B[p+2]=D,B[p+3]=A,B[p+4]=C,B[p+5]=D,p+=6}var O=new THREE.BufferGeometry;O.addAttribute("ind",new THREE.BufferAttribute(c,1)),O.addAttribute("indX",new THREE.BufferAttribute(u,1)),O.addAttribute("rand",new THREE.BufferAttribute(d,1)),O.addAttribute("index",new THREE.BufferAttribute(B,1)),O.addAttribute("uv",new THREE.BufferAttribute(l,2)),O.addAttribute("position",new THREE.BufferAttribute(h,3)),this.attributes={ind:{type:"f",value:[]},indX:{type:"f",value:[]},rand:{type:"f",value:[]}},this.uniforms={vLength:{type:"f",value:t.length},time:{type:"f",value:s},radius:{type:"f",value:e},extraBounce:{type:"f",value:0},reveal:{type:"f",value:0},distRatio:{type:"f",value:m/180},direction:{type:"f",value:1},textSize:{type:"v2",value:new THREE.Vector2(64,64)},vel:{type:"v2",value:new THREE.Vector2(0)},camPos:{type:"v3",value:new THREE.Vector3},camDist:{type:"f",value:0},weight:{type:"f",value:1},color:{type:"v3",value:Scene.COLORDAY},reveal:{type:"f",value:0}};var z=new THREE.ShaderMaterial({vertexShader:window.shaderList.planebeam.vertex,fragmentShader:window.shaderList.planebeam.fragment,blending:THREE.AdditiveBlending,uniforms:this.uniforms,attributes:this.attributes,depthWrite:!1,depthTest:!1,transparent:!0});this.mesh=new THREE.Mesh(O,z),this.showTween=this.hideTween=null}function Scene(t,e){this.locationList=t,Scene.FAR=15e3,Scene.NEAR=1,Scene.VIEW_ANGLE=45,Scene.WIDTH=document.getElementById("globe-global-wrapper").offsetWidth,Scene.HEIGHT=document.getElementById("globe-global-wrapper").offsetHeight,Scene.ASPECT=Scene.WIDTH/Scene.HEIGHT,Scene.COLORDAY=new THREE.Vector3(253/255,137/255,44/255),Scene.COLORNIGHT=new THREE.Vector3(44/255,230/255,253/255),this.zoom=1,this.oldZoom=1,this.started=!0,this.isName=!1,this.percTime=0;var i=Math.min(1.5,window.devicePixelRatio)||1;this.renderer=new THREE.WebGLRenderer({devicePixelRatio:1,autoClear:!0,alpha:!0}),document.getElementById("globe-global-wrapper").appendChild(this.renderer.domElement),this.renderer.domElement.setAttribute("id","canvas3D"),this.renderer.setSize(Scene.WIDTH*i,Scene.HEIGHT*i),this.renderer.domElement.style.width=Scene.WIDTH+"px",this.renderer.domElement.style.height=Scene.HEIGHT+"px",this.camera=new THREE.PerspectiveCamera(Scene.VIEW_ANGLE,Scene.ASPECT,Scene.NEAR,Scene.FAR),this.scene=new THREE.Scene,this.scene.add(this.camera),this.time=0,this.showPercentages=!1,this.camera.position.z=1e3,this.controls=new OrbitControls(this.camera,document.getElementById("canvas3D"),this.touchBack.bind(this)),this.bg=new THREE.Mesh(new THREE.PlaneGeometry(2,2,0),new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(imgList.bg),transparent:!0})),this.bg.material.depthTest=!1,this.bg.material.depthWrite=!1,this.bgScene=new THREE.Scene,this.bgCam=new THREE.Camera,this.bgScene.add(this.bgCam),this.bgScene.add(this.bg),this.globe=new Globe,this.scene.add(this.globe.pointCloud),this.camera.lookAt(this.globe.pointCloud.position),this.controls.minDistance=2*this.globe.radius,this.controls.maxDistance=1e3,this.controls.noPan=!0,this.controls.autoRotate=!1,this.renderer.autoClear=!1,this.vel=new THREE.Vector2(0),this.lightBeamList=[],this.locList=[],this.spriteGeom=new THREE.PlaneBufferGeometry(55,55),this.spriteGeom.applyMatrix((new THREE.Matrix4).makeTranslation(-25,-25,0)),this.mainLocGeom=new THREE.PlaneBufferGeometry(3,3),this.bgCircle=new THREE.Mesh(new THREE.PlaneGeometry(1,1,0),new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(imgList.circle),transparent:!0})),this.resizeCircleBG(),this.bgCircle.material.depthTest=!1,this.bgCircle.material.depthWrite=!1,this.bgCircle.material.transparent=!0,this.bgScene.add(this.bgCircle),utils.swipeFunc.init(document.getElementById("intro-popup"),this.swipePopupComplete.bind(this)),this.mainLocList=[],this.setMainList(e),this.currentLocation=this.mainLocList[0],this.lightPos=new THREE.Vector3(0),this.render(),this.dummy=1,window.addEventListener("resize",this.resize.bind(this),!1),window.setTimeout(function(){window.dispatchEvent(new Event("resize"))}.bind(this),100),this.camPos=new THREE.Vector2(0,-Math.PI-Math.random()*Math.PI*2),this.camRadius=this.camera.position.length(),TweenLite.to(this.camPos,.5+1.5*Math.random(),{y:.5*Math.PI,ease:Expo.easeInOut,onUpdate:this.updateCameraPosition.bind(this),onComplete:this.globeIntroDone.bind(this)})}var mainLocation=null,IMGFOLDER="./img/",imgList={bg:IMGFOLDER+"1920x1080_bg.jpg",circle:IMGFOLDER+"circle-bg.png",earth:IMGFOLDER+"earth_texture_threshold.jpg",earthParticles:IMGFOLDER+"particle.png",locMark:IMGFOLDER+"point.png"},imgTotal=0;document.addEventListener("DOMContentLoaded",function(t){if(!utils.webgl_detect())return void document.getElementById("no-webgl").classList.add("show");for(var e in imgList)imgList.hasOwnProperty(e)&&imgTotal++;for(var e in imgList){var i=document.createElement("img");i.onload=imgPreloaded,i.src=imgList[e]}}),dosetTimeout=function(t,e){window.setTimeout(function(){utils.loadJSON(getCountryLatLng,"https://maps.googleapis.com/maps/api/geocode/json?address="+e[t].toLowerCase()+"&key=AIzaSyBnanZiQ9jdNyxMOqTvmTbOo-Ez9BI7nKw")},500*t)},getCountryLatLng=function(t){var e=JSON.parse(t);if(e.results&&"OK"===e.status){({name:e.results[0].address_components[0].long_name,latlng:e.results[0].geometry.location})}},Globe.prototype.render=function(){},LightBeam.prototype.changeColor=function(t){this.uniforms.color.value=new THREE.Vector3((1-t)*Scene.COLORDAY.x+t*Scene.COLORNIGHT.x,(1-t)*Scene.COLORDAY.y+t*Scene.COLORNIGHT.y,(1-t)*Scene.COLORDAY.z+t*Scene.COLORNIGHT.z),this.lineP&&(this.lineP.uniforms.color.value=this.uniforms.color.value),this.plane.uniforms.color.value=this.uniforms.color.value},LightBeam.prototype.changeWeight=function(t,e){this.weight=t,this.lineP&&this.lineP.changeWeight(t),this.plane.changeWeight(t),this.location.setWeight(t),this.isStart&&(this.checkWeight(),this.isStart=!1)},LightBeam.prototype.checkWeight=function(){if(this.uniforms.weight.value=this.weight,clearTimeout(this.dummy),this.weight<this.threshold)this.isStopped=!0,this.lineP&&(this.lineP.getPT().visible=!1),this.mesh.visible=this.plane.mesh.visible=!1;else{this.isStopped=!1;var t=.2*this.id+3*Math.random()*(1-Math.min(1,this.weight));this.dummy=window.setTimeout(this.show.bind(this),parseInt(1e3*t))}},LightBeam.prototype.drawLine=function(t){var e=this.getPoint(0).clone(),i=this.getPoint(1).clone(),s=new THREE.QuadraticBezierCurve3(e,this.getPoint(.5).clone(),i);this.attributes={ind:{type:"f",value:[]},rand:{type:"v2",value:[]}};var n=this.distance/Math.PI*180,o=50+Math.round(n/180*100);this.vertices=s.getPoints(o),this.particleVertices=[];this.vertices[0];this.extraBounce=0;this.count=0;var a=5,r=new Float32Array(3*this.vertices.length*a),h=new Float32Array(this.vertices.length*a),l=new Float32Array(2*this.vertices.length*a);this.v=0;for(var c=0;c<a;c++){var u=1-Math.abs(c/a*2-1);this.addIn(h,r,l,u),this.addOut(h,r,l,u)}this.geometry.addAttribute("position",new THREE.BufferAttribute(r,3)),this.geometry.addAttribute("ind",new THREE.BufferAttribute(h,1)),this.geometry.addAttribute("rand",new THREE.BufferAttribute(l,2)),this.uniforms={vLength:{type:"f",value:this.vertices.length},time:{type:"f",value:20+1e3*Math.random()},reveal:{type:"f",value:0},extraBounce:{type:"f",value:0},distRatio:{type:"f",value:n/180},radius:{type:"f",value:this.radius},camPos:{type:"v3",value:new THREE.Vector3},camDist:{type:"f",value:0},weight:{type:"f",value:1},total:{type:"f",value:this.count},color:{type:"v3",value:Scene.COLORDAY},direction:{type:"f",value:1}};var d=new THREE.ShaderMaterial({vertexShader:window.shaderList.lightBeam.vertex,fragmentShader:window.shaderList.lightBeam.fragment,uniforms:this.uniforms,attributes:this.attributes,blending:THREE.AdditiveBlending,depthWrite:!1,depthTest:!1,transparent:!0});this.mesh=new THREE.Line(this.geometry,d),t===!0&&(this.lineP=new LineParticles(this.particleVertices,this.from,this.to,this.radius,this.distance,this.uniforms.time.value));for(var m=[],c=0;c<this.vertices.length;c+=3)m.push(this.vertices[c]);this.plane=new PlaneBeam(m,this.radius,this.distance,this.uniforms.time.value),this.lineP&&(this.lineP.getPT().visible=!1),this.mesh.visible=this.plane.mesh.visible=!1,this.dummy=-1,this.showTween=this.hideTween=null},LightBeam.prototype.addBounce=function(){this.mesh.visible&&this.lineP&&TweenMax.to(this.lineP.uniforms.extraBounce,.2,{value:1,ease:Power2.easeOut})},LightBeam.prototype.addOut=function(t,e,i,s){for(var n=Math.random(),o=this.vertices.length-1;o>-1;o--){var a=3*this.v,r=2*this.v;i[r]=Math.random(),i[r+1]=n,t[this.v]=o;var h=utils.vectolatlng(this.vertices[o]),l=utils.latlngtovec(h),c=this.radius+Math.sin(1-Math.abs(2*(o/this.vertices.length-.5)))*(18*this.distance);e[a]=l.x*c,e[a+1]=l.y*c,e[a+2]=l.z*c,this.v++}this.count+=this.vertices.length},LightBeam.prototype.addIn=function(t,e,i,s){for(var n=Math.random(),o=0;o<this.vertices.length;o++){var a=3*this.v,r=2*this.v;i[r]=Math.random(),i[r+1]=n,t[this.v]=o,this.particleVertices.push(this.vertices[o]);var h=utils.vectolatlng(this.vertices[o]),l=utils.latlngtovec(h),c=this.radius+Math.sin(1-Math.abs(2*(o/this.vertices.length-.5)))*Math.max(10,18*this.distance);e[a]=l.x*c,e[a+1]=l.y*c,e[a+2]=l.z*c,this.v++}this.count+=e.length},LightBeam.prototype.show=function(){if(clearTimeout(this.dummy),this.weight<this.threshold)return void(this.isStopped=!0);this.uniforms.time.value=0;var t=Math.random(),e=1.5+Math.random();this.lineP&&this.weight>.02&&(this.lineP.getPT().visible=!0,this.lineP.show(t,e)),this.mesh.visible=this.plane.mesh.visible=!0,this.uniforms.direction.value=1,this.showTween=TweenMax.to(this.uniforms.reveal,e,{value:1,ease:Expo.easeInOut,delay:t}),this.plane.show(t,e),this.location.show(t);var i=t+e+3+2*Math.random()*Math.min(1,this.weight);this.dummy=window.setTimeout(this.hide.bind(this),1e3*i)},LightBeam.prototype.hide=function(){clearTimeout(this.dummy),this.uniforms.direction.value=0;var t=Math.random(),e=1.5+Math.random();this.hideTween=TweenMax.to(this.uniforms.reveal,e,{value:0,ease:Expo.easeInOut,delay:t,onComplete:this.visibleNot.bind(this)}),this.lineP&&this.lineP.hide(t,e),this.plane.hide(t,e),this.location.hide(t+e);var i=t+e+2+2*Math.random()*Math.min(1,this.weight);this.dummy=window.setTimeout(this.show.bind(this),1e3*i)},LightBeam.prototype.visibleNot=function(){this.lineP&&(this.lineP.getPT().visible=!1),this.mesh.visible=this.plane.mesh.visible=!1},LightBeam.prototype.stopAll=function(){clearTimeout(this.dummy);var t=(.5*Math.random(),.5+Math.random());null!==this.hideTween&&this.hideTween.kill(),null!==this.showTween&&this.showTween.kill(),this.hideTween=TweenMax.to(this.uniforms.reveal,t,{value:0,ease:Expo.easeInOut,onComplete:this.checkWeight.bind(this)}),this.lineP&&this.lineP.hide(0,t),this.plane.hide(0,t),this.location.hide(t)},LightBeam.prototype.showAll=function(){clearTimeout(this.dummy)},LightBeam.prototype.killAll=function(){null!==this.hideTween&&this.hideTween.kill(),null!==this.showTween&&this.showTween.kill(),this.lineP&&this.lineP.killAll(),this.plane.killAll()},LightBeam.prototype.removeAll=function(){},LightBeam.prototype.getPoint=function(t){var e=Math.sin((1-t)*this.distance)/Math.sin(this.distance),i=Math.sin(t*this.distance)/Math.sin(this.distance),s=e*Math.cos(this.from.x)*Math.cos(this.from.y)+i*Math.cos(this.to.x)*Math.cos(this.to.y),n=e*Math.cos(this.from.x)*Math.sin(this.from.y)+i*Math.cos(this.to.x)*Math.sin(this.to.y),o=e*Math.sin(this.from.x)+i*Math.sin(this.to.x),a=this.radius;return this.currPos.set(s*a,o*a,n*a),this.currPos},LightBeam.prototype.render=function(){this.uniforms.time.value+=.01,this.lineP&&(this.lineP.uniforms.extraBounce.value+=.05*(0-this.lineP.uniforms.extraBounce.value),this.lineP.uniforms.camPos.value=this.uniforms.camPos.value,this.lineP.uniforms.camDist.value=this.uniforms.camDist.value,this.lineP.render()),this.plane.uniforms.camPos.value=this.uniforms.camPos.value,this.plane.uniforms.camDist.value=this.uniforms.camDist.value,this.plane.render()},LineParticles.prototype.show=function(t,e){this.uniforms.direction.value=1,this.showTween=TweenMax.to(this.uniforms.reveal,.5*e+Math.random()*e*.5,{value:1,ease:Expo.easeInOut,delay:t})},LineParticles.prototype.hide=function(t,e){this.uniforms.direction.value=0,null!==this.showTween&&this.showTween.kill(),this.hideTween=TweenMax.to(this.uniforms.reveal,.5*e+Math.random()*e*.5,{value:0,ease:Expo.easeInOut,delay:t})},LineParticles.prototype.changeWeight=function(t){this.uniforms.weight.value=t},LineParticles.prototype.killAll=function(){null!==this.hideTween&&this.hideTween.kill(),null!==this.showTween&&this.showTween.kill()},LineParticles.prototype.render=function(){this.uniforms.time.value+=.01},LineParticles.prototype.getPT=function(){return this.pointCloud},Location.prototype.fillWeight=function(t,e){this.weights[t]=e},Location.prototype.appear=function(){this.isVisible?TweenLite.to(this.uniforms.reveal,.3,{value:1}):TweenLite.to(this.uniforms.reveal,.3,{value:0}),this.isStarted=!0},Location.prototype.show=function(t){TweenLite.to(this.uniforms.reveal,.1,{value:1,delay:t})},Location.prototype.hide=function(t){TweenLite.to(this.uniforms.reveal,.1,{value:0,delay:t})},Location.prototype.render=function(){},Location.prototype.setWeight=function(t){0===t?(this.uniforms.reveal.value=0,this.isVisible=!1):(this.isStarted&&(this.uniforms.reveal.value=1),this.isVisible=!0)},MainLocation.prototype.setAsMain=function(){TweenLite.to(this.text,.3,{y:50,delay:.2,ease:Power2.easeIn}),TweenLite.to(this.innerClick,.3,{y:100,delay:.3,onComplete:this.showMain.bind(this),ease:Power2.easeIn})},MainLocation.prototype.showMain=function(){for(var t="",e=0;e<this.label.split(" ").length;e++)t+="<div>"+this.label.split(" ")[e]+"</div><br>";this.text.innerHTML=t,this.click.classList.add("main"),this.threetodom.offsetX=20,this.threetodom.offsetY=-52,TweenLite.to(this.text,0,{y:-100}),TweenLite.to(this.innerClick,0,{y:-100}),TweenLite.to(this.text,.3,{y:0,delay:.1,ease:Power2.easeOut}),TweenLite.to(this.innerClick,.3,{y:0,ease:Power2.easeOut})},MainLocation.prototype.removeMain=function(){TweenLite.to(this.text,.3,{y:-100,delay:.2,ease:Power2.easeIn}),TweenLite.to(this.innerClick,.3,{y:-100,delay:.3,onComplete:this.showNormal.bind(this),ease:Power2.easeIn})},MainLocation.prototype.showNormal=function(){this.click.classList.remove("main"),this.threetodom.offsetX=-10,this.threetodom.offsetY=-10,this.text.innerHTML=this.label,TweenLite.to(this.text,0,{y:50}),TweenLite.to(this.innerClick,0,{y:100}),TweenLite.to(this.text,.3,{y:0,delay:.2,ease:Power2.easeOut}),TweenLite.to(this.innerClick,.3,{y:0,ease:Power2.easeOut})},MainLocation.prototype.showClick=function(){this.click.classList.add("show")},MainLocation.prototype.render=function(){this.threetodom.updatePosition()},PlaneBeam.prototype.show=function(t,e){this.uniforms.direction.value=1,this.showTween=TweenMax.to(this.uniforms.reveal,.5*e+Math.random()*e*.5,{value:1,ease:Expo.easeInOut,delay:t})},PlaneBeam.prototype.hide=function(t,e){this.uniforms.direction.value=0,null!==this.showTween&&this.showTween.kill(),this.hideTween=TweenMax.to(this.uniforms.reveal,.5*e+Math.random()*e*.5,{value:0,ease:Expo.easeInOut,delay:t})},PlaneBeam.prototype.killAll=function(){null!==this.hideTween&&this.hideTween.kill(),null!==this.showTween&&this.showTween.kill()},PlaneBeam.prototype.changeWeight=function(t){this.uniforms.weight.value=t},PlaneBeam.prototype.render=function(){this.uniforms.time.value+=.01},Scene.prototype.resizeCircleBG=function(){var t=this.globe.radius*(Scene.HEIGHT/(this.globe.radius+50)),e=1e3*t/this.camera.position.length();this.bgCircle.scale.x=e/Scene.WIDTH*2,this.bgCircle.scale.y=e/Scene.HEIGHT*2},Scene.prototype.resize=function(t){Scene.WIDTH=document.getElementById("globe-global-wrapper").offsetWidth,Scene.HEIGHT=document.getElementById("globe-global-wrapper").offsetHeight,utils.currentDevice=utils.deviceType(),window.setTimeout(this.gotOrientation.bind(this),10)},Scene.prototype.gotOrientation=function(){var t=window.orientation||0;90===Math.abs(t)?(this.controls.minDistance=1.4*this.globe.radius,this.controls.maxDistance=700,this.controls.position0.z=700):(this.controls.minDistance=2*this.globe.radius,this.controls.maxDistance=1e3,this.controls.position0.z=1e3),this.camera.aspect=Scene.WIDTH/Scene.HEIGHT,this.camera.updateProjectionMatrix();var e=Math.min(1.5,window.devicePixelRatio)||1;this.renderer.setSize(Scene.WIDTH*e,Scene.HEIGHT*e),this.renderer.domElement.style.width=Scene.WIDTH+"px",this.renderer.domElement.style.height=Scene.HEIGHT+"px",this.resizeCircleBG();for(var i=0;i<this.lightBeamList.length;i++)this.lightBeamList[i].lineP&&this.lightBeamList[i].lineP.uniforms.window.value.set(Scene.WIDTH,Scene.HEIGHT);this.controls.momementum=Math.min(1,.3+(1-Math.min(1,Math.max(0,(Scene.WIDTH-100)/1024)))),this.controls.rotateSpeed=.7*Math.min(1,.1+.9*Scene.WIDTH/1024),this.controls.reset()},Scene.prototype.globeIntroDone=function(){document.getElementById("intro-popup").classList.remove("left"),document.getElementById("intro-popup").classList.add("show"),document.getElementById("intro-popup").addEventListener("click",this.closePopup.bind(this)),this.controls.autoRotateSpeed=0,this.controls.autoRotate=!0,this.closePopup()},Scene.prototype.closePopup=function(){direction=utils.swipeFunc.touches.direction,document.getElementById("intro-popup").removeEventListener("click",this.closePopup.bind(this)),document.getElementById("intro-popup").addEventListener("click",this.closeTip.bind(this)),document.getElementById("intro-popup").classList.add(direction),document.getElementById("intro-popup").classList.remove("show"),document.querySelector("a.question-mark").classList.add("show"),this.buildClock(),TweenLite.to(this,1.5,{percTime:Math.abs(2*this.getPerc(this.currentLocation)-1),ease:Sine.easeInOut}),this.changeLocation(this.currentLocation.latlng.x,this.currentLocation.latlng.y,this.currentLocation.label,this.currentLocation.file,!0),document.querySelector("a.question-mark").addEventListener("click",this.showTip)},Scene.prototype.swipePopupComplete=function(){this.closePopup()},Scene.prototype.closeTip=function(t){direction=utils.swipeFunc.touches.direction,document.getElementById("intro-popup").classList.remove("show"),document.getElementById("intro-popup").classList.add(direction),document.querySelector("a.question-mark").classList.add("show")},Scene.prototype.showTip=function(t){t.preventDefault(),document.getElementById("intro-popup").classList.add("tip"),document.getElementById("intro-popup").querySelector(".intro-content").classList.remove("show"),document.getElementById("intro-popup").querySelector(".tip-content").classList.add("show"),document.querySelector("a.question-mark").classList.remove("show"),document.getElementById("intro-popup").classList.remove("right"),document.getElementById("intro-popup").classList.remove("top"),document.getElementById("intro-popup").classList.remove("bottom"),document.getElementById("intro-popup").classList.add("show")},Scene.prototype.buildClock=function(){for(var t=document.getElementById("globe-clock").querySelector(".clock"),e=2*Math.PI/24,i=0;i<24;i++){var s=document.createElement("div"),n=e*i;s.style.opacity=0;var o={a:n,rad:0,div:s};this.clockRad=63,"mobile"===utils.currentDevice&&(this.clockRad=43),TweenLite.to(o,.5,{rad:this.clockRad,onUpdateParams:["{self}"],delay:.3+.05*i,ease:Expo.easeInOut,onUpdate:function(t){var e=Math.floor(Math.cos(t.target.a)*t.target.rad),i=Math.floor(Math.sin(t.target.a)*t.target.rad);t.target.div.style[Modernizr.prefixed("transform")]="translate("+e+"px, "+i+"px)",t.target.div.style.opacity=t.target.rad/this.clockRad*.7}.bind(this)}),t.appendChild(s)}this.clockHand=document.createElement("div"),this.clockHand.classList.add("hand"),t.appendChild(this.clockHand),this.handAngle=.5*-Math.PI;var a=Math.cos(this.handAngle)*(this.clockRad-10),r=Math.sin(this.handAngle)*(this.clockRad-10);this.clockHand.style[Modernizr.prefixed("transform")]="translate("+a+"px, "+r+"px)",this.clockHand.style.opacity=0,TweenLite.to(this.clockHand,.2,{opacity:1,delay:.3+24*.05})},Scene.prototype.setMainList=function(t){for(var e=this,i=0;i<t.length;i++){var s=new MainLocation(t[i].latlng,t[i].name,i,t[i].file,t[i].timezone,this.globe.radius,this.mainLocGeom,this.camera);s.click.addEventListener("click",function(t){t.preventDefault(),e.clickLocation(e.mainLocList[parseInt(this.getAttribute("data-id"))])}),this.mainLocList.push(s)}},Scene.prototype.setTime=function(){for(var t=0;t<this.mainLocList.length;t++)this.mainLocList[t].time=moment().tz(this.mainLocList[t].timezone);var e=parseInt(this.currentLocation.time.format("H")),i=parseInt(this.currentLocation.time.format("m"));this.changeSliderTime(e,e/24+i/60*(1/24))},Scene.prototype.getTime=function(){return this.currentLocation.time=moment().tz(this.currentLocation.timezone),parseInt(this.currentLocation.time.format("H"))},Scene.prototype.getPerc=function(t){t.time=moment().tz(t.timezone);var e=parseInt(t.time.format("H")),i=parseInt(t.time.format("m"));return e/24+i/60*(1/24)},Scene.prototype.clickLocation=function(t){if(!this.inTransition){this.started=!0,this.nextLocation=t,this.inTransition=!0,this.controls.enabled=!1,TweenLite.to(this,2,{percTime:Math.abs(2*this.getPerc(t)-1),ease:Sine.easeInOut});var e=document.getElementById("globe-clock").querySelector(".city"),i=document.getElementById("globe-clock").querySelector(".local"),s=document.getElementById("globe-clock").querySelector(".time");TweenLite.to(e,.3,{css:{maxWidth:"0px"},ease:Expo.easeInOut}),TweenLite.to(i,.3,{css:{maxWidth:"0px"},ease:Expo.easeInOut,delay:.1}),TweenLite.to(s,.3,{css:{maxWidth:"0px"},ease:Expo.easeInOut,delay:.2}),TweenLite.to(document.getElementById("globe-clock").querySelector(".clock"),.5,{opacity:.1,ease:Sine.easeOut});for(var n=0;n<this.lightBeamList.length;n++)this.lightBeamList[n].stopAll();this.camPos=utils.vectolatlng(this.camera.position),this.camRadius=this.camera.position.length(),this.currentLocation.removeMain(),TweenLite.to(this.camPos,2,{x:t.latlng.x,y:t.latlng.y,onUpdate:this.updateCameraPosition.bind(this),onComplete:this.destroyLocation.bind(this),ease:Expo.easeInOut})}},Scene.prototype.updateCameraPosition=function(){var t=utils.latlngtovec(this.camPos);this.camera.position.set(t.x*this.camRadius,t.y*this.camRadius,t.z*this.camRadius),this.camera.lookAt(this.globe.pointCloud.position)},Scene.prototype.destroyLocation=function(){for(var t=0;t<this.lightBeamList.length;t++){var e=this.lightBeamList[t];this.scene.remove(e.location.mark),this.scene.remove(e.mesh),this.scene.remove(e.plane.mesh),e.lineP&&this.scene.remove(e.lineP.getPT())}this.lightBeamList=[],this.locList=[],this.currentLocation=this.nextLocation,this.changeLocation(this.nextLocation.latlng.x,this.nextLocation.latlng.y,this.nextLocation.label,this.nextLocation.file)},Scene.prototype.changeLocation=function(t,e,i,s){this.locList=[],this.lightBeamList=[],this.currentLocation.setAsMain(),utils.loadJSON(this.locLoaded.bind(this),s)},Scene.prototype.locLoaded=function(t){this.timeData=JSON.parse(t);var e=this.currentLocation.latlng,i=[],s=this.getTime(),n=0;for(var o in this.timeData[s])n+=this.timeData[s][o];for(var a=0;a<this.locationList.length;a++){var r=this.timeData[s][this.locationList[a].name.toUpperCase()]/n;if(isNaN(r)&&(r=0),10*r>.005){for(var h=!1,l=-1,c=0;c<i.length;c++)if(i[c].name===this.locationList[a].name){h=!0,l=c;break}10*r>.02&&(l!==-1&&(i[c].drawParticles=!0),this.locationList[a].drawParticles=!0),h||i.push(this.locationList[a])}}for(var a=0;a<i.length;a++){var u=i[a],d=u.latlng,m=utils.degtorad(d.lat),p=utils.degtorad(-1*d.lng),v=new THREE.Vector2(m,p),g=new Location(v,u.name,a,this.globe.radius,this.camera,this.spriteGeom,this.zoom);this.locList.push(g);var f=new LightBeam(e,v,this.globe.radius,g,a,this.started);f.drawLine(u.drawParticles),this.scene.add(g.mark),this.scene.add(f.mesh),this.scene.add(f.plane.mesh),f.lineP&&this.scene.add(f.lineP.getPT()),this.lightBeamList.push(f)}this.started=!1,
this.inTransition=!1,this.controls.enabled=!0,this.setTime()},Scene.prototype.changeSliderTime=function(t,e){this.time=Math.floor(t),TweenLite.to(this,3,{handAngle:.5*-Math.PI+e*(2*Math.PI),ease:Expo.easeInOut,onUpdate:function(){var t=Math.cos(this.handAngle)*(this.clockRad-10),e=Math.sin(this.handAngle)*(this.clockRad-10);this.clockHand.style[Modernizr.prefixed("transform")]="translate("+t+"px, "+e+"px)"}.bind(this)});var i=document.getElementById("globe-clock").querySelector(".city"),s=document.getElementById("globe-clock").querySelector(".local"),n=document.getElementById("globe-clock").querySelector(".time");n.querySelector(".digits").innerHTML=this.currentLocation.time.format("hh:mm"),n.querySelector(".ampm").innerHTML=this.currentLocation.time.format("a");for(var o=this.currentLocation.label.split(" "),a="",r=0;r<o.length;r++)a+="<span>"+o[r]+"</span><br>";i.innerHTML=a,TweenLite.to(i,1,{css:{maxWidth:"300px"},ease:Expo.easeInOut}),TweenLite.to(s,1,{css:{maxWidth:"300px"},ease:Expo.easeInOut,delay:.3}),TweenLite.to(n,1,{css:{maxWidth:"300px"},ease:Expo.easeInOut,delay:.5}),TweenLite.to(document.getElementById("globe-clock").querySelector(".clock"),.5,{opacity:1,ease:Sine.easeOut});for(var r=0;r<this.lightBeamList.length;r++)this.lightBeamList[r].stopAll();this.changeTime(t)},Scene.prototype.changeTime=function(t){var e=-99999,i=99999,s=0;for(var n in this.timeData[this.time])e=Math.max(this.timeData[this.time][n],e),i=Math.min(this.timeData[this.time][n],i),s+=this.timeData[this.time][n];for(var o=0,a=0;a<this.lightBeamList.length;a++){var r=0;this.timeData[this.time].hasOwnProperty(this.locList[a].label.toUpperCase())&&(r=this.timeData[this.time][this.locList[a].label.toUpperCase()]/s*10),isNaN(r)&&(r=0),this.lightBeamList[a].changeWeight(r,this.time/24),o+=r}},Scene.prototype.touchBack=function(t,e){for(var i=0;i<this.lightBeamList.length;i++)if(this.lightBeamList[i].lineP){this.lightBeamList[i].lineP.uniforms.mousePos.value.set(t/Scene.WIDTH,e/Scene.HEIGHT);var s=.2+.3*Math.random();TweenLite.to(this.lightBeamList[i].lineP.uniforms.mouseHeight,s,{value:100,ease:Expo.easeInOut}),TweenLite.to(this.lightBeamList[i].lineP.uniforms.mouseHeight,.2+.4*Math.random(),{value:0,delay:s,ease:Power2.easeInOut})}},Scene.prototype.render=function(){window.requestAnimationFrame(this.render.bind(this)),this.zoom=Math.floor(1e4*(1+.95*(1-this.camera.position.length()/1e3)))/1e4,this.controls.autoRotate&&(this.controls.autoRotateSpeed+=.06*(.5-this.controls.autoRotateSpeed)),this.globe.uniforms.zoom.value=this.zoom,this.globe.uniforms.percTime.value=.4+.6*(1-this.percTime),this.globe.uniforms.camPos.value=this.lightPos,this.globe.uniforms.camDist.value=this.lightPos.length(),this.globe.render(),this.vel.x<Math.abs(this.controls.velX)&&(this.vel.x=Math.abs(this.controls.velX)),this.vel.y<Math.abs(this.controls.velY)&&(this.vel.y=Math.abs(this.controls.velY)),this.vel.x+=Math.floor(100*(0-this.vel.x))/100*.1,this.vel.y+=Math.floor(100*(0-this.vel.y))/100*.1;for(var t=0;t<this.lightBeamList.length;t++){if(this.lightBeamList[t].uniforms.camPos.value=this.lightPos,this.lightBeamList[t].uniforms.camDist.value=this.globe.uniforms.camDist.value,this.lightBeamList[t].plane.uniforms.vel.value.x=this.vel.x,this.lightBeamList[t].plane.uniforms.vel.value.y=this.vel.y,this.lightBeamList[t].lineP&&(this.lightBeamList[t].lineP.uniforms.zoom.value=this.zoom,this.lightBeamList[t].lineP.uniforms.vel.value.x=this.vel.x,this.lightBeamList[t].lineP.uniforms.vel.value.y=this.vel.y),this.lightBeamList[t].render(),this.locList[t].uniforms.camDist.value=this.globe.uniforms.camDist.value,this.locList[t].uniforms.camPos.value=this.lightPos,this.oldZoom!==this.zoom){var e=this.camera.position.length()/1e3;this.locList[t].mark.scale.set(e,e,1)}this.locList[t].render()}for(var t=0;t<this.mainLocList.length;t++)this.mainLocList[t].render();this.oldZoom!==this.zoom&&this.resizeCircleBG(),this.oldZoom=this.zoom,this.controls.update(),this.bg.material.opacity=.3+.7*(1-this.percTime),this.bgCircle.material.opacity=.5+.5*(1-this.percTime);var i=.15*Math.PI*(1-this.percTime),s=.1*Math.PI*(1-this.percTime);this.lightPos.x=(this.controls.radius+this.percTime*this.controls.radius)*Math.sin(this.controls.phi-i)*Math.sin(this.controls.theta+s),this.lightPos.y=(this.controls.radius+this.percTime*this.controls.radius)*Math.cos(this.controls.phi-i),this.lightPos.z=(this.controls.radius+this.percTime*this.controls.radius)*Math.sin(this.controls.phi-i)*Math.cos(this.controls.theta+s),this.renderer.clear(),this.renderer.render(this.bgScene,this.bgCam),this.renderer.render(this.scene,this.camera)},utils={},utils.distance3D=function(t,e){var i=t.x-e.x,s=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+s*s+n*n)},utils.radtodeg=function(t){return t/Math.PI*180},utils.degtorad=function(t){return t*Math.PI/180},utils.latlngtovec=function(t){return new THREE.Vector3(Math.cos(t.x)*Math.cos(t.y),Math.sin(t.x),Math.cos(t.x)*Math.sin(t.y))},utils.vectolatlng=function(t){return new THREE.Vector2(Math.atan2(t.y,Math.sqrt(t.x*t.x+t.z*t.z)),Math.atan2(t.z,t.x))},utils.angleFromCoordinate=function(t,e,i,s){var n=s-e,o=Math.sin(n)*Math.cos(i),a=Math.cos(t)*Math.sin(i)-Math.sin(t)*Math.cos(i)*Math.cos(n),r=Math.atan2(o,a);return r=utils.radtodeg(r),r=(r+360)%360,r=360-r,utils.degtorad(r)},utils.easeInOutExpo=function(t,e,i,s){return t/=s/2,t<1?i/2*Math.pow(2,10*(t-1))+e:(t--,i/2*(-Math.pow(2,-10*t)+2)+e)},utils.loadJSON=function(t,e){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",e,!0),i.onreadystatechange=function(){4==i.readyState&&"200"==i.status&&t(i.responseText)},i.send(null)},utils.canWrapText=function(t,e,i,s,n,o){for(var a=e.split("\n"),r=0;r<a.length;r++){for(var h="",l=a[r].split(" "),c=0;c<l.length;c++){var u=h+l[c]+" ",d=t.measureText(u),m=d.width;m>n?(t.fillText(h,i,s),h=l[c]+" ",s+=o):h=u}t.fillText(h,i,s),s+=o}},utils.webgl_detect=function(t){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),i=["webgl","experimental-webgl","moz-webgl","webkit-3d"],s=!1,n=0;n<4;n++)try{if(s=e.getContext(i[n]),s&&"function"==typeof s.getParameter)return!t||{name:i[n],gl:s}}catch(o){}return!1}return!1},utils.currentDevice="",utils.deviceType=function(){var t=768,e=1025,i=1300;return Modernizr.mq("only screen and (max-width: "+(t-1)+"px)")?"mobile":Modernizr.mq("only screen and (min-width: "+t+"px) and (max-width: "+(e-1)+"px)")?"mobile":(Modernizr.mq("only screen and (min-width: "+e+"px) and (max-width: "+(i-1)+"px)"),"desktop")},utils.swipeFunc={touches:{touchstart:{x:-1,y:-1},touchmove:{x:-1,y:-1},touchend:!1,direction:"undetermined"},touchHandler:function(t){var e;if("undefined"!=typeof t&&(t.preventDefault(),"undefined"!=typeof t.touches))switch(e=t.touches[0],t.type){case"touchstart":utils.swipeFunc.touches.direction="undetermined";case"touchmove":utils.swipeFunc.touches[t.type].x=e.pageX,utils.swipeFunc.touches[t.type].y=e.pageY;break;case"touchend":utils.swipeFunc.touches[t.type]=!0;var i=Math.max(utils.swipeFunc.touches.touchmove.x,utils.swipeFunc.touches.touchstart.x)-Math.min(utils.swipeFunc.touches.touchmove.x,utils.swipeFunc.touches.touchstart.x),s=Math.max(utils.swipeFunc.touches.touchmove.y,utils.swipeFunc.touches.touchstart.y)-Math.min(utils.swipeFunc.touches.touchmove.y,utils.swipeFunc.touches.touchstart.y);if(utils.swipeFunc.touches.touchstart.x>-1&&utils.swipeFunc.touches.touchmove.x>-1||utils.swipeFunc.touches.touchstart.y>-1&&utils.swipeFunc.touches.touchmove.y>-1&&(i>1||s>1)){var n=utils.swipeFunc.touches.touchstart.x<utils.swipeFunc.touches.touchmove.x?"right":"left",o=utils.swipeFunc.touches.touchstart.y<utils.swipeFunc.touches.touchmove.y?"bottom":"top";i>=s?utils.swipeFunc.touches.direction=n:utils.swipeFunc.touches.direction=o}utils.swipeFunc.callbackend()}},init:function(t,e){utils.swipeFunc.callbackend=e,t.addEventListener("touchstart",utils.swipeFunc.touchHandler,!1),t.addEventListener("touchmove",utils.swipeFunc.touchHandler,!1),t.addEventListener("touchend",utils.swipeFunc.touchHandler,!1)}},ThreeToDom=function(t,e,i,s,n){this.offsetX=s||0,this.offsetY=n||0,this.camera=t,this.obj=e,this.el=i,this.enabled=!0,this.scale=new THREE.Vector2(1,1),this.box=new THREE.Box3,this.prefix=Modernizr.prefixed("transform")},ThreeToDom.prototype.enable=function(){this.enabled=!0,this.el.style.display="block"},ThreeToDom.prototype.disable=function(){this.enabled=!1,this.el.style.display="none"},ThreeToDom.prototype.checkFaceCamera=function(){var t=(new THREE.Quaternion,new THREE.Vector3(0,0,1).applyQuaternion(this.obj.getWorldQuaternion())),e=new THREE.Vector3(0,0,(-1)).applyQuaternion(this.camera.quaternion);return t.angleTo(e)<=Math.PI/2},ThreeToDom.prototype.updatePosition=function(t){if(this.enabled){this.box.setFromObject(this.obj);var e=this.box.min,i=this.box.max;e=e.project(this.camera),i=i.project(this.camera),e.x=(e.x+1)/2*Scene.WIDTH,e.y=(-e.y+1)/2*Scene.HEIGHT,i.x=(i.x+1)/2*Scene.WIDTH,i.y=(-i.y+1)/2*Scene.HEIGHT;var s=new THREE.Vector2(this.offsetX+e.x+.5*(i.x-e.x),this.offsetY+i.y+.5*(e.y-i.y));t||this.checkFaceCamera()?this.el.style.display="block":this.el.style.display="none",this.el.style[this.prefix]="translate("+s.x+"px, "+s.y+"px)"}};